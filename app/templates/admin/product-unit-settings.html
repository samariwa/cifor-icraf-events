{% if current_user.has_role('SuperUser') %}
{% extends 'superuser/superuser_templates/base_superuser_template.html' %}
{% else %}
{% extends 'admin/admin_templates/base_admin_template.html' %}
{% endif %}

{% block head %}
<!-- Begin Page Content -->
<div class="container-fluid">

    <!-- Page Heading -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">Dashboard <span style="font-size: 18px;">/Stock Flow Automation Settings</span></h1>
       <h6 class="h6 mb-0 text-gray-600 mr-3">Time: <span id="time"></span></h6>
      </div>
    {% endblock %}

    {% block body %}
    <div class="row">
        <div class="col-md-5">   
       <a href="/cashier/stock" class="btn btn-primary btn-md active " role="button" aria-pressed="true"><i class="fa fa-arrow-left"></i>&ensp;Back</a>
       </div>
        <div class="col-md-7">
        <a href="/admin/product-units" class="btn btn-secondary btn-md active offset-9" role="button" aria-pressed="true" >Inventory Units</a>
        </div>
     </div>
     <br>
     <table id="stockSettings" class="table table-striped table-hover paginate" style="display:block;overflow-y:scroll;text-align: center;">
   <thead class="thead-dark">
     <tr>
       <th scope="col" width="4%">#</th>
       <th scope="col" width="23%">Stock Name</th>
       <th scope="col" width="12%">Unit</th>
       <th scope="col"width="12%">Contains</th>
       <th scope="col"width="12%">Subunits</th>
       <th scope="col" width="15%">Subunit Replenish Quantity</th>
       <th scope="col"width="12%">Restock/Replenish Level</th>
       <th scope="col"width="10%"></th>
     </tr>
   </thead>
   <tbody >
    {% for product in products %}
     <tr>
       <th scope="row" class="uneditable" id="id">{{ product.id }}</th>
       <td class="uneditable" id="tbl_name{{ loop.index }}">{{ product.product_name }}</td>
       <td class="uneditable" id="tbl_unit{{ loop.index }}">{{ product.product_unit.unit_name }}</td> 
       <td class="uneditable" id="tbl_contains{{ loop.index }}">{{ product.contains }}</td>
       <td class="uneditable" id="tbl_subunit{{ loop.index }}">{{ product.product_sub_unit.unit_name }}</td>
       <td class="uneditable" id="tbl_replenish{{ loop.index }}">{{ product.subunit_replenish_qty }}</td>
       <td class="uneditable" id="tbl_restock{{ loop.index }}">{{ product.restock_level }}</td>
         <td>  
         <button data-toggle="modal" data-target="#exampleModalScrollable{{ product.id }}" id="{{ product.id }}" data_id="{{ product.id }}" class="btn btn-success btn-sm active setting" role="button" aria-pressed="true" ><i class="fa fa-edit"></i>&ensp;Edit</button>
         <div class="modal fade" id="exampleModalScrollable{{ product.id }}" tabindex="-1" role="dialog" aria-labelledby="exampleModalScrollableTitle" aria-hidden="true">
         <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered" role="document">
           <div class="modal-content">
             <div class="modal-header">
               <h5 class="modal-title" id="exampleModalScrollableTitle">Edit Automation Settings</h5>
               <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                 <span aria-hidden="true">&times;</span>
               </button>
             </div>
             <div class="modal-body">
               <form method="POST">
                {{ set_stock_unit_form.hidden_tag() }}
                 <div class="row">
                   {{ set_stock_unit_form.name.label() }}
                   {{ set_stock_unit_form.name(value=product.product_name, id="name" + product.id|string) }}
                   </div><br>
                  <div class="row">
                   {{ set_stock_unit_form.unit.label() }}
                   <select name="unit" id="unit{{product.id}}" class="form-control col-md-9" onfocus="this.size=3;"  onblur="this.size=1;"    onchange="this.size=1; this.blur();" 
                    style="padding-right:15px;padding-left:15px;margin-left: 60px" required>
                   {% for choice in set_stock_unit_form.unit.choices %}
                      {% if choice[0] ==  product.unit_id %}
                      <option value="{{choice[0]}}" selected>{{ choice[1] }}</option>
                      {% else %}
                      <option value="{{choice[0]}}" >{{ choice[1] }}</option>
                      {% endif %}
                      
                      
                   {% endfor %}
                  </select>
                   
                  </div><br>
                   <div class="row">
                   {{ set_stock_unit_form.contains.label() }}
                   {{ set_stock_unit_form.contains(value=product.contains, id="contains" + product.id|string) }}
                   </div><br>
                   <div class="row">
                    {{ set_stock_unit_form.subunit.label() }}
                     <select name="subunit" id="subunit{{product.id}}" class="form-control col-md-9" onfocus="this.size=3;" onblur="this.size=1;" onchange="this.size=1; this.blur();" 
                    style="padding-right:15px;padding-left:15px;margin-left: 60px" required>
                   {% for choice in set_stock_unit_form.subunit.choices %}
                      {% if choice[0] ==  product.sub_unit_id %}
                      <option value="{{choice[0]}}" selected>{{ choice[1] }}</option>
                      {% else %}
                      <option value="{{choice[0]}}" >{{ choice[1] }}</option>
                      {% endif %}
                   {% endfor %}
                  </select>
                   </div><br>
                   <div class="row">
                    {{ set_stock_unit_form.replenish.label() }}
                     {{ set_stock_unit_form.replenish(value=product.subunit_replenish_qty, id="replenish" + product.id|string) }}
                   </div><br>
                   <div class="row">
                     {{ set_stock_unit_form.restock_level.label() }}
                     {{ set_stock_unit_form.restock_level(value=product.restock_level, id="restock" + product.id|string) }}
                   </div>
             </div>
              <div class="modal-footer">
                {{ set_stock_unit_form.submit(id=product.id) }}
             </form>
             </div>
           </div>
         </div>
       </div>
      </div>
       </td>
     </tr>
     {% endfor %}
   </tbody>
 </table> 
<!-- Scroll to Top Button-->
{% endblock %}